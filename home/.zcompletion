## -*- shell-script -*-

### Caching
zstyle ':completion::complete:*' use-cache on
zstyle ':completion::complete:*' cache-path ~/.cache/zsh/$HOST
###

# Tab Completion
zle -C complete-file complete-word _generic

### Completion Styles
# list of completers to use
zstyle -e ':completion:*'  completer _force_rehash _expand _complete _ignored _approximate
_force_rehash() {
  (( CURRENT == 1 )) && rehash
  return 1	# Because we didn't really complete anything
}

# insert all expansions for expand completer
zstyle ':completion:*:expand:*' tag-order all-expansions
### use $LS_COLORS for general completion
###   Note: (s.:.) splits ${LS_COLORS} into an array
zstyle ':completion:*' list-colors ${(s.:.)LS_COLORS}
zstyle ':completion:*:descriptions' format "- %{${fg[yellow]}%}%d%{${reset_color}%} -"
zstyle ':completion:*:messages'     format "- %{${fg[cyan]}%}%d%{${reset_color}%} -"
zstyle ':completion:*:corrections'  format "- %{${fg[yellow]}%}%d%{${reset_color}%} - (%{${fg[cyan]}%}errors %e%{${reset_color}%})"
zstyle ':completion:*:default'      \
	select-prompt \
	"%{${fg[yellow]}%}Match %{${fg_bold[cyan]}%}%m%{${fg_no_bold[yellow]}%}  Line %{${fg_bold[cyan]}%}%l%{${fg_no_bold[red]}%}  %p%{${reset_color}%}"
zstyle ':completion:*:default'      \
	list-prompt   \
	"%{${fg[yellow]}%}Line %{${fg_bold[cyan]}%}%l%{${fg_no_bold[yellow]}%}  Continue?%{${reset_color}%}"
zstyle ':completion:*:warnings'     \
	format        \
	"- %{${fg_no_bold[red]}%}no match%{${reset_color}%} - %{${fg_no_bold[yellow]}%}%d%{${reset_color}%}"

zstyle ':completion:*:matches' group 'yes'                      # separate matches into groups
zstyle ':completion:*' group-name ''

# Match uppercase from lowercase
zstyle ':completion:*' matcher-list 'm:{a-z}={A-Z}'

# Show original also
zstyle ':completion:*:correct:*' original true

# allow one error for every three characters typed in approximate completer
zstyle -e ':completion:*:approximate:*' max-errors 'reply=( $(( ($#PREFIX+$#SUFFIX)/3 )) numeric )'

# don't complete backup files as executables
zstyle ':completion:*:complete:-command-::commands' ignored-patterns '*\~'

# start menu completion only if it could find no unambiguous initial string
zstyle ':completion:*:correct:*' insert-unambiguous true
###

# Usefull module which can be found here: http://www.bewatermyfriend.org/posts/2007/12-26.11-50-38-tooltime.html
# turn on rehashing
zstyle ':acceptline:*' rehash true # FIXME: Does not work currently.
# clear empty line, if press enter on empty line
zstyle ':acceptline:empty' default_action clear-screen

### Formatting And Messages
# enable verbose completion; descriptions like: '-a  -- list entries starting with .'
zstyle ':completion:*' verbose yes
###

# don't complete lost+found dirs for 'cd'
zstyle ':completion:*:cd:*' ignored-patterns '(*/)#lost+found'

# highlight parameters with uncommon names
zstyle ':completion:*:parameters' \
	list-colors "=[^a-zA-Z]*=$color[red]"

# highlight aliases
    zstyle ':completion:*:aliases' \
        list-colors "=*=$color[green]"

# highlight words like 'esac' or 'end'
zstyle ':completion:*:reserved-words' \
	list-colors "=*=$color[red]"

# enable menu completion
zstyle ':completion:*' menu select

# complete manual by their section
zstyle ':completion:*:manuals'    separate-sections true

# Process Completion
# i like kill <tab>, but i want more processes...
zstyle ':completion:*:processes' command 'ps --forest -A -o pid,user,cmd'
zstyle ':completion:*:processes-names' command 'ps c -u ${USER} -o command | uniq'
# colorize processlist for 'kill'
zstyle ':completion:*:*:kill:*:processes' \
	list-colors "=(#b) #([0-9]#) #([^ ]#)*=$color[cyan]=$color[yellow]=$color[green]"

### highlight the original input.
zstyle ':completion:*:original' list-colors "=*=$color[red];$color[bold]"

# Host and User completion
zstyle ':completion:*:*:*:*:hosts' list-colors '=*=47;30'
zstyle ':completion:*:*:*:*:users' list-colors '=*=34;47'

# vim:ft=zsh:foldmethod=marker
